<!DOCTYPE html>
<html>
<head>
    <title>Room Navigation Test</title>
</head>
<body>
    <h1>Room Navigation Test</h1>
    <div id="test-results"></div>
    <div id="test-logs"></div>
    
    <script>
        // Capture console outputs
        const logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            logs.push(`LOG: ${args.join(' ')}`);
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logs.push(`ERROR: ${args.join(' ')}`);
            originalError.apply(console, args);
        };
        
        async function testRoomNavigation() {
            const results = document.getElementById('test-results');
            const logsDiv = document.getElementById('test-logs');
            
            try {
                results.innerHTML = '<p>üîÑ Loading game scripts...</p>';
                
                // Load scripts in order
                await loadScript('src/dataLoader.js');
                await loadScript('src/enhancedDataLoader.js');
                await loadScript('src/gameState.js');
                
                results.innerHTML += '<p>‚úÖ Scripts loaded successfully</p>';
                
                // Test DataLoader
                const dataLoader = new DataLoader();
                await dataLoader.loadGameData();
                results.innerHTML += '<p>‚úÖ DataLoader works</p>';
                
                // Test EnhancedDataLoader
                const enhancedLoader = new EnhancedDataLoader(dataLoader);
                results.innerHTML += '<p>‚úÖ EnhancedDataLoader created</p>';
                
                // Test the fixed methods
                const rooms = enhancedLoader.getRooms();
                results.innerHTML += `<p>‚úÖ getRooms() works - found ${rooms ? rooms.length : 0} rooms</p>`;
                
                const questions = enhancedLoader.getQuestions();
                results.innerHTML += `<p>‚úÖ getQuestions() works - found ${questions ? questions.length : 0} questions</p>`;
                
                const achievements = enhancedLoader.getAchievements();
                results.innerHTML += `<p>‚úÖ getAchievements() works - found ${achievements ? achievements.length : 0} achievements</p>`;
                
                // Test getRoomById
                if (rooms && rooms.length > 0) {
                    const firstRoom = rooms[0];
                    const roomById = enhancedLoader.getRoomById(firstRoom.id);
                    if (roomById && roomById.id === firstRoom.id) {
                        results.innerHTML += '<p>‚úÖ getRoomById() works correctly</p>';
                    } else {
                        results.innerHTML += '<p>‚ùå getRoomById() failed</p>';
                    }
                }
                
                // Test GameState room movement
                const gameState = new GameState(enhancedLoader);
                
                // Wait for initialization
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (rooms && rooms.length > 1) {
                    const targetRoom = rooms.find(r => !r.isStartingRoom);
                    if (targetRoom) {
                        try {
                            await gameState.moveToRoom(targetRoom.id);
                            results.innerHTML += `<p>‚úÖ Room movement successful to ${targetRoom.name}</p>`;
                        } catch (error) {
                            results.innerHTML += `<p>‚ùå Room movement failed: ${error.message}</p>`;
                        }
                    }
                }
                
                results.innerHTML += '<p>üéâ All tests completed successfully!</p>';
                
            } catch (error) {
                results.innerHTML += `<p>‚ùå Test failed: ${error.message}</p>`;
                console.error('Test error:', error);
            }
            
            // Show logs
            logsDiv.innerHTML = '<h3>Console Logs:</h3>' + 
                logs.map(log => `<div style="font-family:monospace;font-size:12px;margin:2px 0;">${log}</div>`).join('');
        }
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Run test when page loads
        testRoomNavigation();
    </script>
</body>
</html>