<!DOCTYPE html>
<html>
<head>
    <title>Room Accessibility Test</title>
</head>
<body>
    <h1>Room Accessibility Test</h1>
    <div id="test-results"></div>
    <div id="test-logs"></div>
    
    <script>
        // Capture console outputs
        const logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            logs.push(`LOG: ${args.join(' ')}`);
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logs.push(`ERROR: ${args.join(' ')}`);
            originalError.apply(console, args);
        };
        
        async function testRoomAccessibility() {
            const results = document.getElementById('test-results');
            const logsDiv = document.getElementById('test-logs');
            
            try {
                results.innerHTML = '<p>üîÑ Loading game scripts...</p>';
                
                // Load scripts in order
                await loadScript('src/dataLoader.js');
                await loadScript('src/gameState.js');
                await loadScript('src/mapRenderer.js');
                
                results.innerHTML += '<p>‚úÖ Scripts loaded successfully</p>';
                
                // Test DataLoader
                const dataLoader = new DataLoader();
                await dataLoader.loadGameData();
                results.innerHTML += '<p>‚úÖ DataLoader works</p>';
                
                // Test GameState
                const gameState = new GameState(dataLoader);
                
                // Wait for initialization
                await new Promise(resolve => setTimeout(resolve, 500));
                
                results.innerHTML += '<p>‚úÖ GameState created and initialized</p>';
                
                // Test isRoomAccessible method
                if (typeof gameState.isRoomAccessible === 'function') {
                    results.innerHTML += '<p>‚úÖ isRoomAccessible method exists</p>';
                    
                    // Test with current room (should be accessible)
                    const currentRoomAccessible = gameState.isRoomAccessible(gameState.currentRoomId);
                    results.innerHTML += `<p>‚úÖ Current room (${gameState.currentRoomId}) accessible: ${currentRoomAccessible}</p>`;
                    
                    // Test with a random room ID (should likely be false)
                    const testAccessible = gameState.isRoomAccessible('non_existent_room');
                    results.innerHTML += `<p>‚úÖ Non-existent room accessible: ${testAccessible}</p>`;
                    
                    // Get all unlocked rooms
                    const unlockedRooms = Array.from(gameState.unlockedRooms);
                    results.innerHTML += `<p>‚úÖ Unlocked rooms: ${unlockedRooms.join(', ')}</p>`;
                    
                } else {
                    results.innerHTML += '<p>‚ùå isRoomAccessible method missing</p>';
                }
                
                // Test MapRenderer creation (this is where the error was occurring)
                try {
                    // Create a dummy canvas element
                    const canvas = document.createElement('canvas');
                    canvas.width = 800;
                    canvas.height = 400;
                    document.body.appendChild(canvas);
                    
                    const mapRenderer = new MapRenderer(canvas, gameState, dataLoader);
                    results.innerHTML += '<p>‚úÖ MapRenderer created successfully</p>';
                    
                    // Test keyboard navigation (where the error originally occurred)
                    if (typeof mapRenderer.navigateWithKeyboard === 'function') {
                        results.innerHTML += '<p>‚úÖ MapRenderer.navigateWithKeyboard method exists</p>';
                        
                        // This should not throw an error anymore
                        try {
                            mapRenderer.navigateWithKeyboard('north');
                            results.innerHTML += '<p>‚úÖ Keyboard navigation test completed without errors</p>';
                        } catch (navError) {
                            results.innerHTML += `<p>‚ö†Ô∏è Navigation test warning: ${navError.message}</p>`;
                        }
                    }
                    
                } catch (mapError) {
                    results.innerHTML += `<p>‚ùå MapRenderer error: ${mapError.message}</p>`;
                }
                
                results.innerHTML += '<p>üéâ All tests completed!</p>';
                
            } catch (error) {
                results.innerHTML += `<p>‚ùå Test failed: ${error.message}</p>`;
                console.error('Test error:', error);
            }
            
            // Show logs
            logsDiv.innerHTML = '<h3>Console Logs:</h3>' + 
                logs.map(log => `<div style="font-family:monospace;font-size:12px;margin:2px 0;padding:2px;background:#f0f0f0;">${log}</div>`).join('');
        }
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Run test when page loads
        testRoomAccessibility();
    </script>
</body>
</html>