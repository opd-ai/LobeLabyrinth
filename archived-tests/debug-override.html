<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Property Override</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 5px; border-radius: 5px; }
        .error { background: #ffe6e6; }
        .success { background: #e6ffe6; }
    </style>
</head>
<body>
    <h1>Debug Property Override Issue</h1>
    <div id="logs"></div>

    <!-- Minimal DOM elements -->
    <div style="display: none;">
        <div id="room-info"></div>
        <div id="question-area"></div>
        <div id="answer-area"></div>
        <div id="timer-area"></div>
        <div id="score-display"></div>
        <div id="game-controls">
            <button id="new-question-btn">New Question</button>
            <button id="hint-btn">Hint</button>
            <button id="skip-btn">Skip</button>
        </div>
        <div id="feedback-area"></div>
    </div>

    <script>
        let logs = document.getElementById('logs');
        
        function addLog(message, isError = false, isSuccess = false) {
            const div = document.createElement('div');
            div.className = 'log' + (isError ? ' error' : '') + (isSuccess ? ' success' : '');
            div.textContent = message;
            logs.appendChild(div);
            console.log(message);
        }
        
        // First, let's check if the class exists
        addLog('1. Testing class loading...');
        
        // Load scripts one by one and check
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        async function runDebugTest() {
            try {
                addLog('Loading scripts...');
                
                await loadScript('src/dataLoader.js');
                addLog('✓ DataLoader loaded');
                
                await loadScript('src/gameState.js');
                addLog('✓ GameState loaded');
                
                await loadScript('src/quizEngine.js');
                addLog('✓ QuizEngine loaded');
                
                await loadScript('src/uiManager.js');
                addLog('✓ UIManager script loaded');
                
                // Check if UIManager class exists
                if (typeof UIManager !== 'function') {
                    addLog('❌ UIManager is not a constructor function', true);
                    return;
                }
                
                addLog('✓ UIManager class exists');
                
                // Check prototype
                addLog('2. Checking UIManager prototype...');
                const protoMethods = Object.getOwnPropertyNames(UIManager.prototype);
                addLog('Prototype methods: ' + protoMethods.join(', '));
                
                if (UIManager.prototype.isQuestionActive) {
                    addLog('✓ isQuestionActive exists on prototype');
                    addLog('Type: ' + typeof UIManager.prototype.isQuestionActive);
                } else {
                    addLog('❌ isQuestionActive NOT found on prototype', true);
                }
                
                // Create instances step by step
                addLog('3. Creating instances...');
                
                const dataLoader = new DataLoader();
                addLog('✓ DataLoader instance created');
                
                const gameState = new GameState(dataLoader);
                addLog('✓ GameState instance created');
                
                const quizEngine = new QuizEngine(dataLoader, gameState);
                addLog('✓ QuizEngine instance created');
                
                // Debug: Check the properties BEFORE creating UIManager
                addLog('4. Creating UIManager and watching for property override...');
                
                // Create UIManager and immediately check
                const uiManager = new UIManager(dataLoader, gameState, quizEngine);
                addLog('✓ UIManager constructor completed');
                
                // Immediately check the property type
                addLog('5. Checking properties immediately after creation:');
                addLog('typeof uiManager.isQuestionActive: ' + typeof uiManager.isQuestionActive);
                addLog('uiManager.hasOwnProperty("isQuestionActive"): ' + uiManager.hasOwnProperty('isQuestionActive'));
                addLog('uiManager.isQuestionActive value: ' + uiManager.isQuestionActive);
                
                // Check if it's on the prototype
                addLog('typeof UIManager.prototype.isQuestionActive: ' + typeof UIManager.prototype.isQuestionActive);
                
                // Check the prototype chain
                addLog('uiManager.__proto__ === UIManager.prototype: ' + (uiManager.__proto__ === UIManager.prototype));
                
                // Try to call the method from prototype directly
                try {
                    const protoResult = UIManager.prototype.isQuestionActive.call(uiManager);
                    addLog('✓ Calling method from prototype works: ' + protoResult, false, true);
                } catch (error) {
                    addLog('❌ Calling method from prototype failed: ' + error.message, true);
                }
                
                // Check all own properties
                const ownProps = Object.getOwnPropertyNames(uiManager);
                addLog('Own properties: ' + ownProps.filter(p => p.includes('question') || p.includes('Question')).join(', '));
                
            } catch (error) {
                addLog('❌ Test failed: ' + error.message, true);
                addLog('Stack: ' + error.stack);
            }
        }
        
        runDebugTest();
    </script>
</body>
</html>